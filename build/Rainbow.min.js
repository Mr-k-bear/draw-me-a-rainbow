
/**
 * @license
 * Copyright 2021-08-02 MrKBear mrkbear@qq.com
 * All rights reserved.
 * This file is part of the App project.
 * Unauthorized copying of this file, via any medium is strictly prohibited
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).Rainbow={})}(this,(function(t){"use strict";function e(){}function i(){i.init.call(this)}function n(t){return void 0===t._maxListeners?i.defaultMaxListeners:t._maxListeners}function r(t,e,i){if(e)t.call(i);else for(var n=t.length,r=f(t,n),s=0;s<n;++s)r[s].call(i)}function s(t,e,i,n){if(e)t.call(i,n);else for(var r=t.length,s=f(t,r),o=0;o<r;++o)s[o].call(i,n)}function o(t,e,i,n,r){if(e)t.call(i,n,r);else for(var s=t.length,o=f(t,s),a=0;a<s;++a)o[a].call(i,n,r)}function a(t,e,i,n,r,s){if(e)t.call(i,n,r,s);else for(var o=t.length,a=f(t,o),h=0;h<o;++h)a[h].call(i,n,r,s)}function h(t,e,i,n){if(e)t.apply(i,n);else for(var r=t.length,s=f(t,r),o=0;o<r;++o)s[o].apply(i,n)}function l(t,i,r,s){var o,a,h,l;if("function"!=typeof r)throw new TypeError('"listener" argument must be a function');if((a=t._events)?(a.newListener&&(t.emit("newListener",i,r.listener?r.listener:r),a=t._events),h=a[i]):(a=t._events=new e,t._eventsCount=0),h){if("function"==typeof h?h=a[i]=s?[r,h]:[h,r]:s?h.unshift(r):h.push(r),!h.warned&&(o=n(t))&&o>0&&h.length>o){h.warned=!0;var u=new Error("Possible EventEmitter memory leak detected. "+h.length+" "+i+" listeners added. Use emitter.setMaxListeners() to increase limit");u.name="MaxListenersExceededWarning",u.emitter=t,u.type=i,u.count=h.length,l=u,"function"==typeof console.warn?console.warn(l):console.log(l)}}else h=a[i]=r,++t._eventsCount;return t}function u(t,e,i){var n=!1;function r(){t.removeListener(e,r),n||(n=!0,i.apply(t,arguments))}return r.listener=i,r}function c(t){var e=this._events;if(e){var i=e[t];if("function"==typeof i)return 1;if(i)return i.length}return 0}function f(t,e){for(var i=new Array(e);e--;)i[e]=t[e];return i}e.prototype=Object.create(null),i.EventEmitter=i,i.usingDomains=!1,i.prototype.domain=void 0,i.prototype._events=void 0,i.prototype._maxListeners=void 0,i.defaultMaxListeners=10,i.init=function(){this.domain=null,i.usingDomains&&undefined.active,this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=new e,this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},i.prototype.setMaxListeners=function(t){if("number"!=typeof t||t<0||isNaN(t))throw new TypeError('"n" argument must be a positive number');return this._maxListeners=t,this},i.prototype.getMaxListeners=function(){return n(this)},i.prototype.emit=function(t){var e,i,n,l,u,c,f,g="error"===t;if(c=this._events)g=g&&null==c.error;else if(!g)return!1;if(f=this.domain,g){if(e=arguments[1],!f){if(e instanceof Error)throw e;var d=new Error('Uncaught, unspecified "error" event. ('+e+")");throw d.context=e,d}return e||(e=new Error('Uncaught, unspecified "error" event')),e.domainEmitter=this,e.domain=f,e.domainThrown=!1,f.emit("error",e),!1}if(!(i=c[t]))return!1;var v="function"==typeof i;switch(n=arguments.length){case 1:r(i,v,this);break;case 2:s(i,v,this,arguments[1]);break;case 3:o(i,v,this,arguments[1],arguments[2]);break;case 4:a(i,v,this,arguments[1],arguments[2],arguments[3]);break;default:for(l=new Array(n-1),u=1;u<n;u++)l[u-1]=arguments[u];h(i,v,this,l)}return!0},i.prototype.addListener=function(t,e){return l(this,t,e,!1)},i.prototype.on=i.prototype.addListener,i.prototype.prependListener=function(t,e){return l(this,t,e,!0)},i.prototype.once=function(t,e){if("function"!=typeof e)throw new TypeError('"listener" argument must be a function');return this.on(t,u(this,t,e)),this},i.prototype.prependOnceListener=function(t,e){if("function"!=typeof e)throw new TypeError('"listener" argument must be a function');return this.prependListener(t,u(this,t,e)),this},i.prototype.removeListener=function(t,i){var n,r,s,o,a;if("function"!=typeof i)throw new TypeError('"listener" argument must be a function');if(!(r=this._events))return this;if(!(n=r[t]))return this;if(n===i||n.listener&&n.listener===i)0==--this._eventsCount?this._events=new e:(delete r[t],r.removeListener&&this.emit("removeListener",t,n.listener||i));else if("function"!=typeof n){for(s=-1,o=n.length;o-- >0;)if(n[o]===i||n[o].listener&&n[o].listener===i){a=n[o].listener,s=o;break}if(s<0)return this;if(1===n.length){if(n[0]=void 0,0==--this._eventsCount)return this._events=new e,this;delete r[t]}else!function(t,e){for(var i=e,n=i+1,r=t.length;n<r;i+=1,n+=1)t[i]=t[n];t.pop()}(n,s);r.removeListener&&this.emit("removeListener",t,a||i)}return this},i.prototype.off=function(t,e){return this.removeListener(t,e)},i.prototype.removeAllListeners=function(t){var i,n;if(!(n=this._events))return this;if(!n.removeListener)return 0===arguments.length?(this._events=new e,this._eventsCount=0):n[t]&&(0==--this._eventsCount?this._events=new e:delete n[t]),this;if(0===arguments.length){for(var r,s=Object.keys(n),o=0;o<s.length;++o)"removeListener"!==(r=s[o])&&this.removeAllListeners(r);return this.removeAllListeners("removeListener"),this._events=new e,this._eventsCount=0,this}if("function"==typeof(i=n[t]))this.removeListener(t,i);else if(i)do{this.removeListener(t,i[i.length-1])}while(i[0]);return this},i.prototype.listeners=function(t){var e,i=this._events;return i&&(e=i[t])?"function"==typeof e?[e.listener||e]:function(t){for(var e=new Array(t.length),i=0;i<e.length;++i)e[i]=t[i].listener||t[i];return e}(e):[]},i.listenerCount=function(t,e){return"function"==typeof t.listenerCount?t.listenerCount(e):c.call(t,e)},i.prototype.listenerCount=c,i.prototype.eventNames=function(){return this._eventsCount>0?Reflect.ownKeys(this._events):[]};var g,d=[],v="ResizeObserver loop completed with undelivered notifications.";!function(t){t.BORDER_BOX="border-box",t.CONTENT_BOX="content-box",t.DEVICE_PIXEL_CONTENT_BOX="device-pixel-content-box"}(g||(g={}));var p,m=function(t){return Object.freeze(t)},y=function(t,e){this.inlineSize=t,this.blockSize=e,m(this)},b=function(){function t(t,e,i,n){return this.x=t,this.y=e,this.width=i,this.height=n,this.top=this.y,this.left=this.x,this.bottom=this.top+this.height,this.right=this.left+this.width,m(this)}return t.prototype.toJSON=function(){var t=this;return{x:t.x,y:t.y,top:t.top,right:t.right,bottom:t.bottom,left:t.left,width:t.width,height:t.height}},t.fromRect=function(e){return new t(e.x,e.y,e.width,e.height)},t}(),w=function(t){return t instanceof SVGElement&&"getBBox"in t},E=function(t){if(w(t)){var e=t.getBBox(),i=e.width,n=e.height;return!i&&!n}var r=t,s=r.offsetWidth,o=r.offsetHeight;return!(s||o||t.getClientRects().length)},R=function(t){var e,i;if(t instanceof Element)return!0;var n=null===(i=null===(e=t)||void 0===e?void 0:e.ownerDocument)||void 0===i?void 0:i.defaultView;return!!(n&&t instanceof n.Element)},A="undefined"!=typeof window?window:{},x=new WeakMap,L=/auto|scroll/,S=/^tb|vertical/,M=/msie|trident/i.test(A.navigator&&A.navigator.userAgent),B=function(t){return parseFloat(t||"0")},T=function(t,e,i){return void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=!1),new y((i?e:t)||0,(i?t:e)||0)},_=m({devicePixelContentBoxSize:T(),borderBoxSize:T(),contentBoxSize:T(),contentRect:new b(0,0,0,0)}),C=function(t,e){if(void 0===e&&(e=!1),x.has(t)&&!e)return x.get(t);if(E(t))return x.set(t,_),_;var i=getComputedStyle(t),n=w(t)&&t.ownerSVGElement&&t.getBBox(),r=!M&&"border-box"===i.boxSizing,s=S.test(i.writingMode||""),o=!n&&L.test(i.overflowY||""),a=!n&&L.test(i.overflowX||""),h=n?0:B(i.paddingTop),l=n?0:B(i.paddingRight),u=n?0:B(i.paddingBottom),c=n?0:B(i.paddingLeft),f=n?0:B(i.borderTopWidth),g=n?0:B(i.borderRightWidth),d=n?0:B(i.borderBottomWidth),v=c+l,p=h+u,y=(n?0:B(i.borderLeftWidth))+g,R=f+d,A=a?t.offsetHeight-R-t.clientHeight:0,C=o?t.offsetWidth-y-t.clientWidth:0,F=r?v+y:0,P=r?p+R:0,O=n?n.width:B(i.width)-F-C,N=n?n.height:B(i.height)-P-A,z=O+v+C+y,D=N+p+A+R,I=m({devicePixelContentBoxSize:T(Math.round(O*devicePixelRatio),Math.round(N*devicePixelRatio),s),borderBoxSize:T(z,D,s),contentBoxSize:T(O,N,s),contentRect:new b(c,h,O,N)});return x.set(t,I),I},F=function(t,e,i){var n=C(t,i),r=n.borderBoxSize,s=n.contentBoxSize,o=n.devicePixelContentBoxSize;switch(e){case g.DEVICE_PIXEL_CONTENT_BOX:return o;case g.BORDER_BOX:return r;default:return s}},P=function(t){var e=C(t);this.target=t,this.contentRect=e.contentRect,this.borderBoxSize=m([e.borderBoxSize]),this.contentBoxSize=m([e.contentBoxSize]),this.devicePixelContentBoxSize=m([e.devicePixelContentBoxSize])},O=function(t){if(E(t))return 1/0;for(var e=0,i=t.parentNode;i;)e+=1,i=i.parentNode;return e},N=function(){var t=1/0,e=[];d.forEach((function(i){if(0!==i.activeTargets.length){var n=[];i.activeTargets.forEach((function(e){var i=new P(e.target),r=O(e.target);n.push(i),e.lastReportedSize=F(e.target,e.observedBox),r<t&&(t=r)})),e.push((function(){i.callback.call(i.observer,n,i.observer)})),i.activeTargets.splice(0,i.activeTargets.length)}}));for(var i=0,n=e;i<n.length;i++){(0,n[i])()}return t},z=function(t){d.forEach((function(e){e.activeTargets.splice(0,e.activeTargets.length),e.skippedTargets.splice(0,e.skippedTargets.length),e.observationTargets.forEach((function(i){i.isActive()&&(O(i.target)>t?e.activeTargets.push(i):e.skippedTargets.push(i))}))}))},D=function(){var t,e=0;for(z(e);d.some((function(t){return t.activeTargets.length>0}));)e=N(),z(e);return d.some((function(t){return t.skippedTargets.length>0}))&&("function"==typeof ErrorEvent?t=new ErrorEvent("error",{message:v}):((t=document.createEvent("Event")).initEvent("error",!1,!1),t.message=v),window.dispatchEvent(t)),e>0},I=[],U=function(t){if(!p){var e=0,i=document.createTextNode("");new MutationObserver((function(){return I.splice(0).forEach((function(t){return t()}))})).observe(i,{characterData:!0}),p=function(){i.textContent=""+(e?e--:e++)}}I.push(t),p()},X=0,Y={attributes:!0,characterData:!0,childList:!0,subtree:!0},V=["resize","load","transitionend","animationend","animationstart","animationiteration","keyup","keydown","mouseup","mousedown","mouseover","mouseout","blur","focus"],k=function(t){return void 0===t&&(t=0),Date.now()+t},W=!1,G=new(function(){function t(){var t=this;this.stopped=!0,this.listener=function(){return t.schedule()}}return t.prototype.run=function(t){var e=this;if(void 0===t&&(t=250),!W){W=!0;var i,n=k(t);i=function(){var i=!1;try{i=D()}finally{if(W=!1,t=n-k(),!X)return;i?e.run(1e3):t>0?e.run(t):e.start()}},U((function(){requestAnimationFrame(i)}))}},t.prototype.schedule=function(){this.stop(),this.run()},t.prototype.observe=function(){var t=this,e=function(){return t.observer&&t.observer.observe(document.body,Y)};document.body?e():A.addEventListener("DOMContentLoaded",e)},t.prototype.start=function(){var t=this;this.stopped&&(this.stopped=!1,this.observer=new MutationObserver(this.listener),this.observe(),V.forEach((function(e){return A.addEventListener(e,t.listener,!0)})))},t.prototype.stop=function(){var t=this;this.stopped||(this.observer&&this.observer.disconnect(),V.forEach((function(e){return A.removeEventListener(e,t.listener,!0)})),this.stopped=!0)},t}()),H=function(t){!X&&t>0&&G.start(),!(X+=t)&&G.stop()},j=function(){function t(t,e){this.target=t,this.observedBox=e||g.CONTENT_BOX,this.lastReportedSize={inlineSize:0,blockSize:0}}return t.prototype.isActive=function(){var t,e=F(this.target,this.observedBox,!0);return t=this.target,w(t)||function(t){switch(t.tagName){case"INPUT":if("image"!==t.type)break;case"VIDEO":case"AUDIO":case"EMBED":case"OBJECT":case"CANVAS":case"IFRAME":case"IMG":return!0}return!1}(t)||"inline"!==getComputedStyle(t).display||(this.lastReportedSize=e),this.lastReportedSize.inlineSize!==e.inlineSize||this.lastReportedSize.blockSize!==e.blockSize},t}(),q=function(t,e){this.activeTargets=[],this.skippedTargets=[],this.observationTargets=[],this.observer=t,this.callback=e},J=new WeakMap,K=function(t,e){for(var i=0;i<t.length;i+=1)if(t[i].target===e)return i;return-1},Z=function(){function t(){}return t.connect=function(t,e){var i=new q(t,e);J.set(t,i)},t.observe=function(t,e,i){var n=J.get(t),r=0===n.observationTargets.length;K(n.observationTargets,e)<0&&(r&&d.push(n),n.observationTargets.push(new j(e,i&&i.box)),H(1),G.schedule())},t.unobserve=function(t,e){var i=J.get(t),n=K(i.observationTargets,e),r=1===i.observationTargets.length;n>=0&&(r&&d.splice(d.indexOf(i),1),i.observationTargets.splice(n,1),H(-1))},t.disconnect=function(t){var e=this,i=J.get(t);i.observationTargets.slice().forEach((function(i){return e.unobserve(t,i.target)})),i.activeTargets.splice(0,i.activeTargets.length)},t}(),Q=function(){function t(t){if(0===arguments.length)throw new TypeError("Failed to construct 'ResizeObserver': 1 argument required, but only 0 present.");if("function"!=typeof t)throw new TypeError("Failed to construct 'ResizeObserver': The callback provided as parameter 1 is not a function.");Z.connect(this,t)}return t.prototype.observe=function(t,e){if(0===arguments.length)throw new TypeError("Failed to execute 'observe' on 'ResizeObserver': 1 argument required, but only 0 present.");if(!R(t))throw new TypeError("Failed to execute 'observe' on 'ResizeObserver': parameter 1 is not of type 'Element");Z.observe(this,t,e)},t.prototype.unobserve=function(t){if(0===arguments.length)throw new TypeError("Failed to execute 'unobserve' on 'ResizeObserver': 1 argument required, but only 0 present.");if(!R(t))throw new TypeError("Failed to execute 'unobserve' on 'ResizeObserver': parameter 1 is not of type 'Element");Z.unobserve(this,t)},t.prototype.disconnect=function(){Z.disconnect(this)},t.toString=function(){return"function ResizeObserver () { [polyfill code] }"},t}();class $ extends i{canvas;div;get dom(){return this.div}get can(){return this.canvas}pixelRatio=devicePixelRatio??1;get width(){return this.canvas.width}get height(){return this.canvas.height}get offsetWidth(){return this.canvas.offsetWidth}get offsetHeight(){return this.canvas.offsetHeight}get scaleX(){return this.canvas.width/this.canvas.offsetWidth}get scaleY(){return this.canvas.height/this.canvas.offsetHeight}get ratio(){return this.canvas.offsetWidth/this.canvas.offsetHeight}offsetFlg=[NaN,NaN];resize(){this.offsetWidth===this.offsetFlg[0]&&this.offsetHeight===this.offsetFlg[1]||(this.offsetFlg[0]=this.offsetWidth,this.offsetFlg[1]=this.offsetHeight,this.canvas.width=this.offsetWidth*this.pixelRatio,this.canvas.height=this.offsetHeight*this.pixelRatio,this.emit("resize",this))}mouseX=0;mouseY=0;mouseUvX=0;mouseUvY=0;mouseGlX=0;mouseGlY=0;mouseMotionX=0;mouseMotionY=0;mouseFlg=[NaN,NaN];calcMouseData(t,e){return(t!==this.mouseFlg[0]||e!==this.mouseFlg[1])&&(this.mouseX=t,this.mouseY=e,this.mouseUvX=t/this.offsetWidth,this.mouseUvY=e/this.offsetHeight,this.mouseGlX=2*this.mouseUvX-1,this.mouseGlY=2*-this.mouseUvY+1,this.mouseMotionX=t-this.mouseFlg[0],this.mouseMotionY=e-this.mouseFlg[1],this.mouseFlg[0]=t,this.mouseFlg[1]=e,!0)}calcMouseDataFromTouchEvent(t){if(t.touches.length<=0)return;let e=t.touches[0].clientX-this.canvas.offsetLeft,i=t.touches[0].clientY-this.canvas.offsetTop;return this.calcMouseData(e,i)}touchCount=0;mouseDown=!1;obs=null;constructor(t,e){super();let i=e??{},n=i.autoResize??!0,r=i.mouseEvent??!0,s=i.eventLog??!1;this.canvas=t??document.createElement("canvas"),this.div=document.createElement("div"),this.div.appendChild(this.canvas),this.canvas.style.width="100%",this.canvas.style.height="100%",n&&(this.obs=new(window.ResizeObserver||Q)((t=>{for(let e of t)e.target===this.canvas&&this.resize()})),this.obs.observe(this.canvas)),r&&(this.canvas.addEventListener("mouseup",(t=>{this.touchCount>=2?this.touchCount=0:(s&&console.log("GLCanvas: mouseup"),this.mouseDown=!1,this.calcMouseData(t.offsetX,t.offsetY),this.emit("mouseup",this))})),this.canvas.addEventListener("touchstart",(t=>{this.touchCount=1,s&&console.log("GLCanvas: touchstart"),this.mouseDown=!0,this.calcMouseDataFromTouchEvent(t),this.emit("mousedown",this)})),this.canvas.addEventListener("mousedown",(t=>{this.touchCount>=2||(s&&console.log("GLCanvas: mousedown"),this.mouseDown=!0,this.calcMouseData(t.offsetX,t.offsetY),this.emit("mousedown",this))})),this.canvas.addEventListener("touchend",(t=>{this.touchCount++,s&&console.log("GLCanvas: touchend"),this.mouseDown=!1,this.calcMouseDataFromTouchEvent(t),this.emit("mouseup",this)})),this.canvas.addEventListener("mousemove",(t=>{this.touchCount>=2||(s&&console.log("GLCanvas: mousemove"),this.calcMouseData(t.offsetX,t.offsetY)&&this.emit("mousemove",this))})),this.canvas.addEventListener("touchmove",(t=>{s&&console.log("GLCanvas: touchmove"),this.calcMouseDataFromTouchEvent(t)&&this.emit("mousemove",this)})))}}class tt{gl;vertexShaderSource="";fragmentShaderSource="";vertexShader;fragmentShader;program;setSource(t,e){return this.vertexShaderSource=t.replace(/^\s+/,""),this.fragmentShaderSource=e.replace(/^\s+/,""),this}compile(){return this.program=this.gl.createProgram(),this.vertexShader=this.gl.createShader(this.gl.VERTEX_SHADER),this.fragmentShader=this.gl.createShader(this.gl.FRAGMENT_SHADER),this.gl.shaderSource(this.vertexShader,this.vertexShaderSource),this.gl.shaderSource(this.fragmentShader,this.fragmentShaderSource),this.gl.compileShader(this.vertexShader),this.gl.compileShader(this.fragmentShader),this.gl.getShaderParameter(this.vertexShader,this.gl.COMPILE_STATUS)||console.error("vertex:\r\n"+this.gl.getShaderInfoLog(this.vertexShader)),this.gl.getShaderParameter(this.fragmentShader,this.gl.COMPILE_STATUS)||console.error("fragment:\r\n"+this.gl.getShaderInfoLog(this.fragmentShader)),this.gl.attachShader(this.program,this.vertexShader),this.gl.attachShader(this.program,this.fragmentShader),this.gl.linkProgram(this.program),this.gl.getProgramParameter(this.program,this.gl.LINK_STATUS)||console.error("link:\r\n"+this.gl.getProgramInfoLog(this.program)),this}constructor(t){this.gl=t,this.onload()}onload(){}attribLocationCache={};uniformLocationCache={};attribLocate(t){let e=this.attribLocationCache[t];return void 0===e||e<=-1?(e=this.gl.getAttribLocation(this.program,t),void 0===e||e<=-1?console.error("Attrib: can not get locate of "+t):this.gl.enableVertexAttribArray(e),this.attribLocationCache[t]=e,e):(this.gl.enableVertexAttribArray(e),e)}uniformLocate(t){let e=this.uniformLocationCache[t];return e||(e=this.gl.getUniformLocation(this.program,t),e||console.error("Uniform: can not get locate of "+t),this.uniformLocationCache[t]=e,e)}use(){return this.gl.useProgram(this.program),this}}var et=1e-6,it="undefined"!=typeof Float32Array?Float32Array:Array;function nt(){var t=new it(16);return it!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t}function rt(){var t=new it(3);return it!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function st(t,e,i,n){return t[0]=e,t[1]=i,t[2]=n,t}function ot(t,e,i){var n=e[0],r=e[1],s=e[2],o=i[3]*n+i[7]*r+i[11]*s+i[15];return o=o||1,t[0]=(i[0]*n+i[4]*r+i[8]*s+i[12])/o,t[1]=(i[1]*n+i[5]*r+i[9]*s+i[13])/o,t[2]=(i[2]*n+i[6]*r+i[10]*s+i[14])/o,t}Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)});var at=function(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t};function ht(){var t=new it(2);return it!=Float32Array&&(t[0]=0,t[1]=0),t}rt(),function(){var t=ht()}();var lt=function(){var t=0,e=document.createElement("div");function i(t){return e.appendChild(t.dom),t}function n(i){for(var n=0;n<e.children.length;n++)e.children[n].style.display=n===i?"block":"none";t=i}e.style.cssText="position:fixed;top:0;left:0;cursor:pointer;opacity:0.9;z-index:10000",e.addEventListener("click",(function(i){i.preventDefault(),n(++t%e.children.length)}),!1);var r=(performance||Date).now(),s=r,o=0,a=i(new lt.Panel("FPS","#0ff","#002")),h=i(new lt.Panel("MS","#0f0","#020"));if(self.performance&&self.performance.memory)var l=i(new lt.Panel("MB","#f08","#201"));return n(0),{REVISION:16,dom:e,addPanel:i,showPanel:n,begin:function(){r=(performance||Date).now()},end:function(){o++;var t=(performance||Date).now();if(h.update(t-r,200),t>s+1e3&&(a.update(1e3*o/(t-s),100),s=t,o=0,l)){var e=performance.memory;l.update(e.usedJSHeapSize/1048576,e.jsHeapSizeLimit/1048576)}return t},update:function(){r=this.end()},domElement:e,setMode:n}};lt.Panel=function(t,e,i){var n=1/0,r=0,s=Math.round,o=s(window.devicePixelRatio||1),a=80*o,h=48*o,l=3*o,u=2*o,c=3*o,f=15*o,g=74*o,d=30*o,v=document.createElement("canvas");v.width=a,v.height=h,v.style.cssText="width:80px;height:48px";var p=v.getContext("2d");return p.font="bold "+9*o+"px Helvetica,Arial,sans-serif",p.textBaseline="top",p.fillStyle=i,p.fillRect(0,0,a,h),p.fillStyle=e,p.fillText(t,l,u),p.fillRect(c,f,g,d),p.fillStyle=i,p.globalAlpha=.9,p.fillRect(c,f,g,d),{dom:v,update:function(h,m){n=Math.min(n,h),r=Math.max(r,h),p.fillStyle=i,p.globalAlpha=1,p.fillRect(0,0,a,f),p.fillStyle=e,p.fillText(s(h)+" "+t+" ("+s(n)+"-"+s(r)+")",l,u),p.drawImage(v,c+o,f,g-o,d,c,f,g-o,d),p.fillRect(c+g-o,f,o,d),p.fillStyle=i,p.globalAlpha=.9,p.fillRect(c+g-o,f,o,s((1-h/m)*d))}}};class ut{static AXIS_VER_DATA=new Float32Array([0,0,0,1,0,0,0,0,0,0,1,0,0,0,0,0,0,1]);axisVertexBuffer;onload(){this.axisVertexBuffer=this.gl.createBuffer(),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.axisVertexBuffer),this.gl.bufferData(this.gl.ARRAY_BUFFER,ut.AXIS_VER_DATA,this.gl.STATIC_DRAW)}gl;constructor(t){this.gl=t,this.onload()}r=1;pos=[0,0,0];draw(t,e){e.use(),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.axisVertexBuffer),this.gl.vertexAttribPointer(e.attribLocate("vPos"),3,this.gl.FLOAT,!1,0,0),e.mvp(t.transformMat),e.r([this.r,this.r,this.r]),e.pos(this.pos),e.color([1,0,0]),this.gl.drawArrays(this.gl.LINES,0,2),e.color([0,1,0]),this.gl.drawArrays(this.gl.LINES,2,2),e.color([0,0,1]),this.gl.drawArrays(this.gl.LINES,4,2)}}class ct{static CUBE_VER_DATA=new Float32Array([1,1,1,-1,1,1,-1,1,-1,1,1,-1,1,-1,1,-1,-1,1,-1,-1,-1,1,-1,-1]);static CUBE_ELE_DATA=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]);onload(){this.cubeVertexBuffer=this.gl.createBuffer(),this.cubeElementBuffer=this.gl.createBuffer(),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.cubeVertexBuffer),this.gl.bufferData(this.gl.ARRAY_BUFFER,ct.CUBE_VER_DATA,this.gl.STATIC_DRAW),this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,this.cubeElementBuffer),this.gl.bufferData(this.gl.ELEMENT_ARRAY_BUFFER,ct.CUBE_ELE_DATA,this.gl.STATIC_DRAW)}gl;constructor(t){this.gl=t,this.onload()}cubeVertexBuffer;cubeElementBuffer;r=[1,1,1];draw(t,e){e.use(),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.cubeVertexBuffer),this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,this.cubeElementBuffer),this.gl.vertexAttribPointer(e.attribLocate("vPos"),3,this.gl.FLOAT,!1,0,0),e.mvp(t.transformMat),e.r(this.r),e.pos([0,0,0]),e.color([.2,.2,.2]),this.gl.drawElements(this.gl.LINES,24,this.gl.UNSIGNED_SHORT,0)}}class ft{pointA;pointB;handA;handB;len=0;tempVal;setSimpVal(t,e,i,n){this.pointA.length=0,this.pointB.length=0,this.handA.length=0,this.handB.length=0,this.pointA.push(t),this.pointB.push(e),this.handA.push(i),this.handB.push(n)}bezierM(t){this.len&&(this.len=Math.min(this.pointA.length,this.pointB.length,this.handA.length,this.handB.length)),this.tempVal=gt.bezier3(t);let e=[];for(let t=0;t<this.len;t++)e[t]=this.pointA[t]*this.tempVal[0]+this.handA[t]*this.tempVal[1]+this.handB[t]*this.tempVal[2]+this.pointB[t]*this.tempVal[3];return e}}class gt{static bezier3(t){return[(1-t)**3,3*t*(1-t)**2,3*t**2*(1-t),t**3]}static genSmoothLine(t,e=!1,i=1,n=1){let r=[],s=new ft;for(let e=0;e<t.length-1;e++){s.pointA=t[e],s.pointB=t[e+1],s.handA=[s.pointA[0]+i,s.pointA[1]],s.handB=[s.pointB[0]-i,s.pointB[1]],s.len=2;const o=(s.pointB[0]-s.pointA[0])/n;for(let t=0;t<o;t++)r.push(s.bezierM(t/o)[1])}return e&&r.push(t[t.length-1][1]),r}static genRandomPointR(t,e,i){let n=[];for(let t=0;t<e;t++)n.push([Math.random(),2*(Math.random()-.5)*i]);n=n.sort(((t,e)=>t[0]-e[0]));let r=n[0][0],s=n[n.length-1][0]-r;for(let e=0;e<n.length;e++)n[e][0]=Math.floor((n[e][0]-r)*t/s);return n}static genRandomPointM(t,e,i){let n=[];for(let r=0;r<e;r++)n.push([Math.floor(r*t/(e-1)),2*(Math.random()-.5)*i]);return n}static random(t,e){return Math.random()*(e-t)+t}}class dt{gl;vertexBuffer;pointNum;static NORMAL_COLOR=[111/255,149/255,191/255];constructor(t){this.gl=t;let e=gt.random(.98,1.02);this.color=[e*dt.NORMAL_COLOR[0],e*dt.NORMAL_COLOR[1],e*dt.NORMAL_COLOR[2]];let i=Math.random(),n=this.genBuffer(.35+.3*i,.03+.03*i+.01*Math.random(),Math.floor(gt.random(5,9)),.8+.3*i+.1*Math.random());this.vertexBuffer=this.gl.createBuffer(),this.pointNum=n.length/3,this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.vertexBuffer),this.gl.bufferData(this.gl.ARRAY_BUFFER,new Float32Array(n),this.gl.STATIC_DRAW)}pos=[0,0,0];genBuffer(t,e,i,n=1,r=Math.PI/180){const s=[0,0],o=[0,0,0];let a=2*Math.PI/r,h=gt.genRandomPointM(a,i,e);h[h.length-1][1]=h[0][1];let l=gt.genSmoothLine(h,!1,n);for(let e=0;e<l.length;e++){let i=2*e*Math.PI/l.length;s[0]=Math.cos(i),s[1]=Math.sin(i),o.push(s[0]*(t+l[e])),o.push(s[1]*(t+l[e])),o.push(0)}return o.push(o[3]),o.push(o[4]),o.push(o[5]),o}color;draw(t,e){e.use(),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.vertexBuffer),this.gl.vertexAttribPointer(e.attribLocate("vPos"),3,this.gl.FLOAT,!1,0,0),e.mvp(t.transformMat),e.color(this.color),e.r([1,1,1]),e.pos([0,0,0]),this.gl.drawArrays(this.gl.TRIANGLE_FAN,0,this.pointNum)}}t.BasicsShader=class extends tt{onload(){this.setSource("\n        attribute vec3 vPos;\n        \n        uniform vec3 r;\n        uniform mat4 mvp;\n        uniform vec3 pos;\n\n        void main(){\n            gl_Position = mvp * vec4(vPos * r + pos, 1.);\n        }\n        ","\n        precision lowp float;\n        \n        uniform vec3 color;\n    \n        void main(){\n            gl_FragColor = vec4(color, 1.);\n        }\n        "),this.compile()}r(t){return this.gl.uniform3fv(this.uniformLocate("r"),t),this}pos(t){return this.gl.uniform3fv(this.uniformLocate("pos"),t),this}mvp(t,e=!1){return this.gl.uniformMatrix4fv(this.uniformLocate("mvp"),e,t),this}color(t){this.gl.uniform3fv(this.uniformLocate("color"),t)}},t.Bezier3=ft,t.Camera=class{canvas;eye;target;up;range=Math.PI/9;ratio=1;nearFar;viewMat;projectionMat;transformMat;transformNMat;constructor(t){var e,i,n;this.canvas=t,this.eye=rt(),this.target=rt(),this.up=rt(),this.nearFar=ht(),this.viewMat=nt(),this.projectionMat=nt(),this.transformMat=nt(),this.transformNMat=nt(),st(this.eye,0,0,10),st(this.up,0,1,0),e=this.nearFar,i=.001,n=1e3,e[0]=i,e[1]=n,this.tempRayP=rt(),this.tempRayO=rt(),this.tempRayPoint=rt()}tempRayPoint;tempRayP;tempRayO;generateMat(){var t,e,i,n,r,s,o,a,h,l,u,c,f,g,d,v,p,m,y,b,w,E,R;this.ratio=this.canvas.ratio,t=this.viewMat,e=this.eye,i=this.target,n=this.up,d=e[0],v=e[1],p=e[2],m=n[0],y=n[1],b=n[2],w=i[0],E=i[1],R=i[2],Math.abs(d-w)<et&&Math.abs(v-E)<et&&Math.abs(p-R)<et?function(t){t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1}(t):(u=d-w,c=v-E,f=p-R,r=y*(f*=g=1/Math.hypot(u,c,f))-b*(c*=g),s=b*(u*=g)-m*f,o=m*c-y*u,(g=Math.hypot(r,s,o))?(r*=g=1/g,s*=g,o*=g):(r=0,s=0,o=0),a=c*o-f*s,h=f*r-u*o,l=u*s-c*r,(g=Math.hypot(a,h,l))?(a*=g=1/g,h*=g,l*=g):(a=0,h=0,l=0),t[0]=r,t[1]=a,t[2]=u,t[3]=0,t[4]=s,t[5]=h,t[6]=c,t[7]=0,t[8]=o,t[9]=l,t[10]=f,t[11]=0,t[12]=-(r*d+s*v+o*p),t[13]=-(a*d+h*v+l*p),t[14]=-(u*d+c*v+f*p),t[15]=1),function(t,e,i,n,r){var s,o=1/Math.tan(e/2);t[0]=o/i,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=o,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,null!=r&&r!==1/0?(s=1/(n-r),t[10]=(r+n)*s,t[14]=2*r*n*s):(t[10]=-1,t[14]=-2*n)}(this.projectionMat,this.range,this.ratio,this.nearFar[0],this.nearFar[1]),function(t,e,i){var n=e[0],r=e[1],s=e[2],o=e[3],a=e[4],h=e[5],l=e[6],u=e[7],c=e[8],f=e[9],g=e[10],d=e[11],v=e[12],p=e[13],m=e[14],y=e[15],b=i[0],w=i[1],E=i[2],R=i[3];t[0]=b*n+w*a+E*c+R*v,t[1]=b*r+w*h+E*f+R*p,t[2]=b*s+w*l+E*g+R*m,t[3]=b*o+w*u+E*d+R*y,b=i[4],w=i[5],E=i[6],R=i[7],t[4]=b*n+w*a+E*c+R*v,t[5]=b*r+w*h+E*f+R*p,t[6]=b*s+w*l+E*g+R*m,t[7]=b*o+w*u+E*d+R*y,b=i[8],w=i[9],E=i[10],R=i[11],t[8]=b*n+w*a+E*c+R*v,t[9]=b*r+w*h+E*f+R*p,t[10]=b*s+w*l+E*g+R*m,t[11]=b*o+w*u+E*d+R*y,b=i[12],w=i[13],E=i[14],R=i[15],t[12]=b*n+w*a+E*c+R*v,t[13]=b*r+w*h+E*f+R*p,t[14]=b*s+w*l+E*g+R*m,t[15]=b*o+w*u+E*d+R*y}(this.transformMat,this.projectionMat,this.viewMat),function(t,e){var i=e[0],n=e[1],r=e[2],s=e[3],o=e[4],a=e[5],h=e[6],l=e[7],u=e[8],c=e[9],f=e[10],g=e[11],d=e[12],v=e[13],p=e[14],m=e[15],y=i*a-n*o,b=i*h-r*o,w=i*l-s*o,E=n*h-r*a,R=n*l-s*a,A=r*l-s*h,x=u*v-c*d,L=u*p-f*d,S=u*m-g*d,M=c*p-f*v,B=c*m-g*v,T=f*m-g*p,_=y*T-b*B+w*M+E*S-R*L+A*x;_&&(_=1/_,t[0]=(a*T-h*B+l*M)*_,t[1]=(r*B-n*T-s*M)*_,t[2]=(v*A-p*R+m*E)*_,t[3]=(f*R-c*A-g*E)*_,t[4]=(h*S-o*T-l*L)*_,t[5]=(i*T-r*S+s*L)*_,t[6]=(p*w-d*A-m*b)*_,t[7]=(u*A-f*w+g*b)*_,t[8]=(o*B-a*S+l*x)*_,t[9]=(n*S-i*B-s*x)*_,t[10]=(d*R-v*w+m*y)*_,t[11]=(c*w-u*R-g*y)*_,t[12]=(a*L-o*M-h*x)*_,t[13]=(i*M-n*L+r*x)*_,t[14]=(v*b-d*E-p*y)*_,t[15]=(u*E-c*b+f*y)*_)}(this.transformNMat,this.transformMat)}angleX=90;angleY=0;setEyeFromAngle(){at(this.eye,this.eye,this.target);let t=(e=this.eye,i=e[0],n=e[1],r=e[2],Math.hypot(i,n,r));var e,i,n,r;let s=rt(),o=Math.cos(this.angleX*Math.PI/180),a=Math.sin(this.angleX*Math.PI/180),h=Math.cos(this.angleY*Math.PI/180);st(s,o*h*t,Math.sin(this.angleY*Math.PI/180)*t,a*h*t),function(t,e){t[0]=e[0],t[1]=e[1],t[2]=e[2]}(this.eye,s),function(t,e,i){t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2]}(this.eye,this.eye,this.target)}sensitivity=.5;ctrl(t,e){this.angleX+=t*this.sensitivity,this.angleY+=e*this.sensitivity,this.angleX>360&&(this.angleX=this.angleX-360),this.angleX<0&&(this.angleX=360+this.angleX),this.angleY>90&&(this.angleY=90),this.angleY<-90&&(this.angleY=-90),this.setEyeFromAngle()}rayTrack(t,e){return st(this.tempRayP,t,e,1),ot(this.tempRayP,this.tempRayP,this.transformNMat),st(this.tempRayO,t,e,0),ot(this.tempRayO,this.tempRayO,this.transformNMat),at(this.tempRayP,this.tempRayP,this.tempRayO),function(t,e){var i=e[0],n=e[1],r=e[2],s=i*i+n*n+r*r;s>0&&(s=1/Math.sqrt(s)),t[0]=e[0]*s,t[1]=e[1]*s,t[2]=e[2]*s}(this.tempRayP,this.tempRayP),[this.tempRayO,this.tempRayP]}EL=1e-5;scaleRay(t,e,i,n){e<this.EL&&(e=this.EL);let r=t/e;return this.tempRayPoint[0]=i[0]+n[0]*r,this.tempRayPoint[1]=i[1]+n[1]*r,this.tempRayPoint[2]=i[2]+n[2]*r,this.tempRayPoint}intersectionLineXYPlant(t,e,i=0){let n=Math.abs(e[2]-i),r=Math.abs(t[2]-i);return this.scaleRay(r,n,t,e)}intersectionLineXZPlant(t,e,i=0){let n=Math.abs(e[1]-i),r=Math.abs(t[1]-i);return this.scaleRay(r,n,t,e)}intersectionLineYZPlant(t,e,i=0){let n=Math.abs(e[0]-i),r=Math.abs(t[0]-i);return this.scaleRay(r,n,t,e)}},t.Clock=class{allTime=0;speed=1;stats;isStatsOn=!1;useStats(){return this.stats=new lt,this.isStatsOn=!0,this.stats.showPanel(0),document.body.appendChild(this.stats.dom),this}fn;constructor(t){this.fn=t??(t=>{})}setFn(t){this.fn=t}run(){let t=e=>{this.isStatsOn&&this.stats.begin();let i=(e-this.allTime)*this.speed/1e3;e-this.allTime<100&&this.fn(i),this.allTime=e,this.isStatsOn&&this.stats.end(),requestAnimationFrame(t)};requestAnimationFrame((e=>{this.allTime=e,requestAnimationFrame(t)}))}},t.GLCanvas=$,t.GLProgram=tt,t.GLRenderer=class{canvas;gl;glVersion=0;getContext(){this.gl=this.canvas.can.getContext("webgl2"),this.gl?(this.glVersion=2,console.log("Render: Using WebGL2 :)")):(this.gl=this.canvas.can.getContext("webgl"),this.gl?(this.glVersion=1,console.log("Render: Using WebGL1 :(")):console.error("Render: Not supported WebGL!"))}cleanColor=[.92,.92,.92,1];clean(){this.gl.clearColor(this.cleanColor[0],this.cleanColor[1],this.cleanColor[2],this.cleanColor[3]),this.gl.clear(this.gl.COLOR_BUFFER_BIT|this.gl.DEPTH_BUFFER_BIT)}constructor(t,e){this.canvas=new $(t,e),this.getContext()}},t.Planet=dt,t.SmoothTool=gt,t.TestAxis=ut,t.TestBox=ct,Object.defineProperty(t,"__esModule",{value:!0})}));
